(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60c1e716"],{"02c6":function(t,e,a){"use strict";var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Select",{style:{width:t.width+"px",height:"32px"},attrs:{disabled:1==t.companyList.length},on:{"on-change":t.changeCom},model:{value:t.companyId,callback:function(e){t.companyId=e},expression:"companyId"}},[1!=t.companyList.length?a("Option",{attrs:{value:0}},[t._v("全部")]):t._e(),t._l(t.companyList,function(e){return a("Option",{key:e.Id,attrs:{value:e.Id}},[t._v(t._s(e.name))])})],2)},i=[],n=(a("d4d5"),{name:"Companyselect",props:{companyList:Array,selectCompany:Number,width:{default:200,type:Number}},computed:{companyId:{get:function(){return this.selectCompany},set:function(){}}},methods:{changeCom:function(t){this.$emit("changeComId",t)}}}),s=n,l=a("17cc"),r=Object(l["a"])(s,o,i,!1,null,null,null),d=r.exports;a.d(e,"a",function(){return d})},1394:function(t,e,a){},8985:function(t,e,a){"use strict";var o=a("b0e5"),i=a.n(o);i.a},b0e5:function(t,e,a){},cc9d:function(t,e,a){"use strict";var o=a("1394"),i=a.n(o);i.a},f2e6:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{attrs:{title:"导入设备","mask-closable":!1,"footer-hide":!0,width:300},on:{"on-visible-change":t.uploadModalChange},model:{value:t.uploadModal,callback:function(e){t.uploadModal=e},expression:"uploadModal"}},[a("Form",{ref:"uploadForm",attrs:{model:t.uploadForm,"label-width":70,rules:t.ruleUpload}},[a("FormItem",{attrs:{label:"选择公司",prop:"companyId"}},[a("Select",{staticStyle:{width:"200px"},model:{value:t.uploadForm.companyId,callback:function(e){t.$set(t.uploadForm,"companyId",e)},expression:"uploadForm.companyId"}},t._l(t.companyList,function(e){return a("Option",{key:e.Id,attrs:{value:e.Id}},[t._v(t._s(e.name))])}),1)],1),a("FormItem",{attrs:{label:"上传模式",prop:"importType"}},[a("RadioGroup",{model:{value:t.uploadForm.importType,callback:function(e){t.$set(t.uploadForm,"importType",e)},expression:"uploadForm.importType"}},[a("Radio",{attrs:{label:1}},[t._v("增量上传")]),a("Radio",{attrs:{label:2}},[t._v("覆盖上传")])],1)],1),a("FormItem",{staticClass:"fileWrap",attrs:{label:"选择文件"}},[a("Upload",{ref:"upload",staticClass:"tbHBtn",attrs:{accept:".xlsx",action:t.url+"deviceimport","show-upload-list":!1,"before-upload":t.handleUpload}},[a("Button",{attrs:{type:"primary",icon:"ios-cloud-upload-outline"}},[t._v("导入文件")])],1),""!==t.uploadForm.file&&null!==t.uploadForm.file?a("div",{staticClass:"upLoadname"},[t._v("Upload file: "+t._s(t.uploadForm.file.name)+" ")]):t._e()],1),a("FormItem",{staticClass:"footer"},[""!==t.uploadForm.file&&null!==t.uploadForm.file?a("Button",{attrs:{type:"warning",loading:t.uploadLoadingStatus},on:{click:t.upload}},[t._v("\r\n          "+t._s(t.uploadLoadingStatus?"Uploading":"点击上传")+"\r\n        ")]):t._e()],1)],1)],1),a("Table",{ref:"currentRowTable",attrs:{columns:t.columns,data:t.deviceData,"highlight-row":"",height:t.tableHeight},on:{"on-sort-change":t.changeSort},scopedSlots:t._u([{key:"action",fn:function(e){var o=e.row;e.index;return[a("Button",{staticClass:"tBtn",attrs:{type:"error",size:"small"},on:{click:function(e){return t.handleRowEdit(o)}}},[t._v("修改")])]}}])},[a("div",{staticClass:"theader",attrs:{slot:"header"},slot:"header"},[a("Button",{staticClass:"tbHBtn",attrs:{type:"primary",icon:"md-add-circle"},on:{click:t.handleAddPerson}},[a("span",[t._v("添加设备")])]),a("Button",{staticClass:"tbHBtn",attrs:{type:"primary",icon:"ios-cloud-upload-outline"},on:{click:t.handleImportDevice}},[a("span",[t._v("导入设备")])]),a("Button",{staticClass:"tbHBtn",attrs:{type:"primary",icon:"down"==t.timeOrder?"md-arrow-dropup":"md-arrow-dropdown"},on:{click:t.changeTimeOrder}},[a("span",[t._v("时间排序")])]),a("Select",{staticClass:"tbHBtn",staticStyle:{width:"150px"},attrs:{placeholder:"选择是否安装"},model:{value:t.selectStatus,callback:function(e){t.selectStatus=e},expression:"selectStatus"}},[a("Option",{attrs:{value:3}},[t._v("全部")]),a("Option",{attrs:{value:1}},[t._v("未安装")]),a("Option",{attrs:{value:2}},[t._v("已安装")])],1),a("Companyselect",{staticClass:"tbHBtn",attrs:{width:150,companyList:t.companyList,selectCompany:t.deviceParams.companyId},on:{changeComId:t.changeCom}})],1),a("Page",{attrs:{slot:"footer","class-name":"totalfr",total:t.dataTotal,"page-size":t.deviceParams.limit,"show-total":"",current:t.deviceParams.pageNum},on:{"on-change":t.changePage},slot:"footer"})],1),a("Modal",{attrs:{title:"修改设备信息","mask-closable":!1,"footer-hide":!0},on:{"on-visible-change":t.changeState},model:{value:t.mapModalShow,callback:function(e){t.mapModalShow=e},expression:"mapModalShow"}},[a("Form",{ref:"mapItem",attrs:{model:t.mapItem,"label-width":80,rules:t.ruleValidate}},[a("FormItem",{attrs:{label:"设备号",prop:"device_id"}},[a("Input",{attrs:{placeholder:"输入设备号"},model:{value:t.mapItem.device_id,callback:function(e){t.$set(t.mapItem,"device_id",e)},expression:"mapItem.device_id"}})],1),a("FormItem",{attrs:{label:"所属公司",prop:"company_id"}},[a("Select",{staticStyle:{width:"200px"},model:{value:t.mapItem.company_id,callback:function(e){t.$set(t.mapItem,"company_id",e)},expression:"mapItem.company_id"}},t._l(t.companyList,function(e){return a("Option",{key:e.Id,attrs:{value:e.Id}},[t._v(t._s(e.name))])}),1)],1),t.mapItem.address?a("baidu-map",{staticClass:"map",staticStyle:{display:"flex","flex-direction":"column"},attrs:{center:{lng:t.mapItem.lng,lat:t.mapItem.lat},zoom:18,"scroll-wheel-zoom":!0},on:{ready:t.map_handler}},[a("FormItem",{attrs:{label:"地址"}},[a("Input",{attrs:{placeholder:"输入地址"},model:{value:t.mapItem.address,callback:function(e){t.$set(t.mapItem,"address",e)},expression:"mapItem.address"}})],1),a("Row",{attrs:{gutter:24}},[a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"经度"}},[a("Input",{attrs:{placeholder:"输入经度"},model:{value:t.mapItem.lng,callback:function(e){t.$set(t.mapItem,"lng",e)},expression:"mapItem.lng"}})],1)],1),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"纬度"}},[a("Input",{attrs:{placeholder:"输入纬度"},model:{value:t.mapItem.lat,callback:function(e){t.$set(t.mapItem,"lat",e)},expression:"mapItem.lat"}})],1)],1)],1),a("bm-view",{staticStyle:{width:"100%",height:"350px",flex:"1"}}),a("bm-marker",{attrs:{position:{lng:t.mapItem.lng,lat:t.mapItem.lat},dragging:!0,"auto-resize":!0},on:{dragend:t.showPosition}})],1):t._e(),a("FormItem",{staticClass:"editmFooter"},[a("Button",{on:{click:t.mapModalClose}},[t._v("取消")]),a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("mapItem")}}},[t._v("修改")])],1)],1)],1),a("Modal",{attrs:{title:"新增设备","mask-closable":!1,"footer-hide":!0},on:{"on-visible-change":t.changeState},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[a("Form",{ref:"modalForm",attrs:{model:t.modalForm,"label-width":80,rules:t.ruleValidate},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSubmit(e)}}},[a("FormItem",{attrs:{label:"地址"}},[a("Input",{attrs:{placeholder:"输入地址"},model:{value:t.modalForm.address,callback:function(e){t.$set(t.modalForm,"address",e)},expression:"modalForm.address"}})],1),a("FormItem",{attrs:{label:"经度"}},[a("Input",{attrs:{placeholder:"输入经度"},model:{value:t.modalForm.lng,callback:function(e){t.$set(t.modalForm,"lng",e)},expression:"modalForm.lng"}})],1),a("FormItem",{attrs:{label:"纬度"}},[a("Input",{attrs:{placeholder:"输入纬度"},model:{value:t.modalForm.lat,callback:function(e){t.$set(t.modalForm,"lat",e)},expression:"modalForm.lat"}})],1),a("FormItem",{attrs:{label:"设备号",prop:"device_id"}},[a("Input",{attrs:{placeholder:"输入设备号"},model:{value:t.modalForm.device_id,callback:function(e){t.$set(t.modalForm,"device_id",e)},expression:"modalForm.device_id"}})],1),a("FormItem",{attrs:{label:"所属公司",prop:"company_id"}},[a("Select",{staticStyle:{width:"200px"},model:{value:t.modalForm.company_id,callback:function(e){t.$set(t.modalForm,"company_id",e)},expression:"modalForm.company_id"}},t._l(t.companyList,function(e){return a("Option",{key:e.Id,attrs:{value:e.Id}},[t._v(t._s(e.name))])}),1)],1),a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("modalForm")}}},[t._v("提交")]),a("Button",{staticStyle:{"margin-left":"8px"}},[t._v("取消")])],1)],1)],1)],1)},i=[],n=(a("7364"),a("d4d5"),a("e20c")),s=a("ad5d"),l=a("4878"),r=a("c276"),d=a("591a"),c=a("02c6"),m=a("f121"),p="";p=m["a"].baseUrl.pro;var u={components:{Companyselect:c["a"],BaiduMap:s["a"],BmView:l["BmView"],BmMarker:l["BmMarker"]},data:function(){return{url:p,timeOrder:"down",selectStatus:"",selectComId:"",modalState:"",mapItem:{address:"",id:"",lng:"",lat:"",device_id:"",company_id:""},infoShow:!1,mapModalShow:!1,modal:!1,modalForm:{address:"",lng:"",lat:"",device_id:"",company_id:""},ruleValidate:{device_id:[{required:!0,message:"设备号不能为空",trigger:"blur"}],company_id:[{required:!0,type:"number",message:"请选择公司",trigger:"change"}]},columns:[{title:"设备号",key:"device_id",minWidth:180},{title:"所属公司",key:"company",minWidth:180},{title:"地址",key:"address",minWidth:200},{title:"是否安装",key:"status",minWidth:120,render:function(t,e){return 0===e.row.status?t("span","未安装"):t("span","已安装")}},{title:"安装时间",key:"setuptime",minWidth:170,render:function(t,e){if(""===e.row.setuptime)return t("span","");var a=Object(r["c"])(e.row.setuptime);return t("span",a)}},{title:"操作",slot:"action",minWidth:70,align:"center"}],deviceData:[],dataTotal:0,uploadForm:{file:"",importType:1,companyId:""},ruleUpload:{companyId:[{required:!0,type:"number",message:"请选择公司",trigger:"change"}]},uploadModal:!1,uploadLoadingStatus:!1,deviceParams:{companyId:0,pageNum:1,limit:100,offset:"",sort:"setuptime",order:"asc",status:3}}},computed:Object(n["a"])({},Object(d["e"])({companyList:function(t){return t.user.companyList},token:function(t){return t.user.token},tableHeight:function(t){return t.user.windowH-60},comId:function(t){return t.user.comId}})),watch:{selectStatus:function(t){this.deviceParams.status=t,this.deviceParams.pageNum=1,this.setDeviceList()}},created:function(){this.initPage()},methods:Object(n["a"])({},Object(d["b"])(["getCompanyList","deviceList","addDevice","editDevice","importDevice"]),{setDeviceList:function(){var t=this,e=JSON.parse(JSON.stringify(this.deviceParams));e.offset=(Number(e.pageNum)-1)*Number(e.limit),this.deviceList(e).then(function(e){0===e.status?(t.deviceData=null===e.data.list?[]:e.data.list,t.dataTotal=e.data.count):(t.deviceData=[],t.dataTotal=0)})},initPage:function(){0===this.companyList.length&&this.getCompanyList(),1!==this.comId&&(this.deviceParams.companyId=this.comId),this.setDeviceList()},map_handler:function(t){var e=t.BMap;t.map;this.BMap=e},changePage:function(t){this.deviceParams.pageNum=t,this.setDeviceList()},handleRowEdit:function(t){this.mapItem=JSON.parse(JSON.stringify(t)),this.modalState="edit",this.mapModalShow=!0},ok:function(){},cancel:function(){},handleAddPerson:function(){this.modalState="add",this.modal=!0},infoWindowOpen:function(){this.infoShow=!0},infoWindowClose:function(){this.infoShow=!1},showPosition:function(t){var e,a=this,o=(t.type,t.target,t.pixel,t.point),i=this.BMap,n=new i.Geocoder;this.mapItem.lng=String(o.lng),this.mapItem.lat=String(o.lat),n.getLocation(o,function(t){var o=t.addressComponents;e="".concat(o.province).concat(o.city).concat(o.district).concat(o.street).concat(o.streetNumber),console.log(o),a.mapItem.address=e})},handleSubmit:function(t){var e=this;this.$refs[t].validate(function(t){t?"add"===e.modalState?e.addDevice(e.modalForm).then(function(t){0===t.status?(e.$Message.success("新增成功"),e.setDeviceList(),e.modal=!1):e.$Message.error(t.msg)}):"edit"===e.modalState&&e.editDevice(e.mapItem).then(function(t){0===t.status?(e.$Message.success("编辑成功"),e.setDeviceList(),e.mapModalShow=!1):e.$Message.error(t.msg)}):e.$Message.error("Fail!")})},changeState:function(t){t||this.$refs.modalForm.resetFields()},mapModalClose:function(){this.mapModalShow=!1},handleImportDevice:function(){this.uploadModal=!0},handleUpload:function(t){return this.uploadForm.file=t,!1},upload:function(){var t=this;this.uploadLoadingStatus=!0,this.$refs.uploadForm.validate(function(e){if(e){var a=new FormData;a.append("file",t.uploadForm.file),a.append("companyId",t.uploadForm.companyId),a.append("importType",t.uploadForm.importType),a.append("token",t.$store.state.user.token),t.importDevice(a).then(function(e){0!==e.status?t.$Message.error(e.msg):1===t.uploadForm.importType?t.$Message.success("添加："+e.data+"个设备"):2===t.uploadForm.importType&&t.$Message.success("覆盖添加："+e.data+"个设备"),t.deviceParams.pageNum=1,t.setDeviceList(),t.uploadLoadingStatus=!1,t.uploadModal=!1})}else t.uploadLoadingStatus=!1,t.$Message.error("Fail!")})},uploadModalChange:function(t){!1===t&&(this.$refs.uploadForm.resetFields(),this.uploadForm.file="")},changeSort:function(t,e,a){console.log(t),"normal"!==t.order&&(this.deviceParams.order=t.order),this.setDeviceList()},changeTimeOrder:function(){"down"===this.timeOrder?(this.timeOrder="up",this.deviceParams.order="desc"):(this.timeOrder="down",this.deviceParams.order="asc"),this.setDeviceList()},changeCom:function(t){this.deviceParams.companyId=t,this.setDeviceList()}})},h=u,f=(a("cc9d"),a("8985"),a("17cc")),v=Object(f["a"])(h,o,i,!1,null,"54a4ed81",null);e["default"]=v.exports}}]);