(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c22a84f2"],{"08eb":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Table",{ref:"table",attrs:{columns:t.columns,data:t.deviceData,height:t.tableHeight,loading:t.loading},scopedSlots:t._u([{key:"state",fn:function(e){var i=e.row;e.index;return["70"==i.state&&0!=i.status?a("Tag",{staticClass:"stateTag",attrs:{type:"dot",color:"error"}},[t._v("离线")]):t._e(),"80"==i.state&&0!=i.status?a("Tag",{staticClass:"stateTag",attrs:{type:"dot",color:"error"}},[t._v("故障")]):t._e(),"70"!=i.state&&"80"!=i.state&&0!=i.status?a("Tag",{staticClass:"stateTag",attrs:{type:"dot",color:"success"}},[t._v("在线")]):t._e(),0==i.status?a("Tag",{attrs:{color:"default"}},[t._v("未安装")]):t._e()]}},{key:"signal",fn:function(e){var i=e.row;e.index;return[""==i.signal?a("img",{staticStyle:{width:"22px"},attrs:{src:t.signal0}}):t._e(),""!=i.signal&&0==parseInt(i.signal/6)?a("img",{staticStyle:{width:"22px"},attrs:{src:t.signal1}}):t._e(),1==parseInt(i.signal/6)?a("img",{staticStyle:{width:"22px"},attrs:{src:t.signal2}}):t._e(),2==parseInt(i.signal/6)?a("img",{staticStyle:{width:"22px"},attrs:{src:t.signal3}}):t._e(),3==parseInt(i.signal/6)?a("img",{staticStyle:{width:"22px"},attrs:{src:t.signal4}}):t._e(),parseInt(i.signal/6)>=4?a("img",{staticStyle:{width:"22px"},attrs:{src:t.signal5}}):t._e()]}},{key:"action",fn:function(e){var i=e.row;e.index;return[a("Button",{attrs:{type:"primary",size:"small",ghost:""},on:{click:function(e){return t.eventQuery(i)}}},[t._v("事件查询")])]}},{key:"address",fn:function(e){var i=e.row;e.index;return[""!=i.lng?a("span",{staticStyle:{cursor:"pointer"},attrs:{type:"text"},on:{click:function(e){return t.goMap(i)}}},[t._v("\r\n        "+t._s(i.address)+"\r\n        "),a("Icon",{attrs:{type:"md-arrow-dropright"}})],1):t._e()]}}])},[a("Page",{attrs:{slot:"footer",current:t.deviceParams.pageNum,"class-name":"totalfr","page-size":t.deviceParams.limit,total:t.dataTotal,size:"small","show-total":""},on:{"on-change":t.changePage},slot:"footer"})],1),t.ifeventModal?[a("eventModal",{attrs:{actionUrl:t.url,queryDeviceId:t.queryDeviceId,modal:t.eventModalShow},on:{modalState:t.eventModalState}})]:t._e()],2)},s=[],n=(a("d4d5"),a("e20c")),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{title:"事件查询:"+t.queryDeviceId,width:90,"footer-hide":!0,styles:{top:"20px",height:"calc(100% - 50px)"},"mask-closable":!1},on:{"on-visible-change":t.modalStateChange},model:{value:t.eventModal,callback:function(e){t.eventModal=e},expression:"eventModal"}},[a("Row",[a("Col",{staticClass:"demo-tabs-style1",attrs:{span:"24"}},[a("Tabs",{attrs:{type:"card"},on:{"on-click":t.tabClick},model:{value:t.tabValue,callback:function(e){t.tabValue=e},expression:"tabValue"}},[a("form",{attrs:{slot:"extra",action:t.actionUrl+"deviceEventExport",method:"post"},slot:"extra"},[a("input",{attrs:{type:"text",hidden:"",name:"exportType"},domProps:{value:t.tabValue}}),a("input",{attrs:{type:"text",hidden:"",name:"deviceId"},domProps:{value:t.queryDeviceId}}),a("input",{attrs:{type:"text",hidden:"",name:"token"},domProps:{value:t.token}}),a("input",{attrs:{type:"text",hidden:"",name:"showType"},domProps:{value:t.tab1Params.showType}}),a("input",{attrs:{type:"text",hidden:"",name:"dataType"},domProps:{value:t.tab2Params.dataType}}),a("input",{attrs:{type:"text",hidden:"",name:"selectTime"},domProps:{value:t.tab2Params.selectTime}}),a("input",{attrs:{type:"text",hidden:"",name:"timeType"},domProps:{value:t.tab2Params.timeType}}),a("Button",{staticClass:"exprot",attrs:{"html-type":"submit",type:"primary",size:"small"}},[a("Icon",{attrs:{type:"ios-download-outline"}}),t._v(" 导出")],1)],1),a("TabPane",{attrs:{label:"接收事件"}},[a("div",{staticClass:"tabTop"},[t._v("\n              显示：\n              "),a("RadioGroup",{attrs:{type:"button",size:"small"},on:{"on-change":t.showTypeChange},model:{value:t.tab1Params.showType,callback:function(e){t.$set(t.tab1Params,"showType",e)},expression:"tab1Params.showType"}},[a("Radio",{attrs:{label:1}},[t._v("全部")]),a("Radio",{attrs:{label:2}},[t._v("异常")]),a("Radio",{attrs:{label:3}},[t._v("告警")])],1)],1),a("Table",{attrs:{columns:t.tab1columns,data:t.tab1Data,height:t.tableHeight-165,border:!1}},[a("Page",{attrs:{slot:"footer","class-name":"totalfr",total:t.tab1total,"page-size":t.tab1Params.limit,size:"small","show-total":""},on:{"on-change":t.tab1PageChange},slot:"footer"})],1)],1),a("TabPane",{attrs:{label:"原始数据"}},[a("div",{staticClass:"tabTop"},[a("RadioGroup",{on:{"on-change":t.tab2TimeTypeChange},model:{value:t.tab2Params.timeType,callback:function(e){t.$set(t.tab2Params,"timeType",e)},expression:"tab2Params.timeType"}},[a("Radio",{attrs:{label:1}},[a("span",[t._v("全部")])]),a("Radio",{attrs:{label:2}},[a("span",[t._v("本周")])]),a("Radio",{attrs:{label:3}},[a("span",[t._v("上周")])]),a("Radio",{attrs:{label:4}},[a("span",[t._v("本月")])]),a("Radio",{attrs:{label:5}},[a("span",[t._v("上月")])]),a("Radio",{attrs:{label:6}},[a("span",[t._v("指定时间")]),a("DatePicker",{staticStyle:{width:"200px"},attrs:{value:t.selectTime,type:"date",placeholder:"Select date",format:"yyyy-MM-dd"},on:{"on-change":t.tab2selectTimeChange}})],1)],1)],1),a("div",{staticClass:"tabTop"},[a("RadioGroup",{attrs:{type:"button",size:"small"},on:{"on-change":t.tab2DataTypeChange},model:{value:t.tab2Params.dataType,callback:function(e){t.$set(t.tab2Params,"dataType",e)},expression:"tab2Params.dataType"}},[a("Radio",{attrs:{label:1}},[t._v("全部")]),a("Radio",{attrs:{label:2}},[t._v("失联")]),a("Radio",{attrs:{label:3}},[t._v("心跳")]),a("Radio",{attrs:{label:4}},[t._v("水压")]),a("Radio",{attrs:{label:5}},[t._v("栓帽打开")])],1)],1),a("Table",{attrs:{columns:t.tab2Columns,data:t.tab2Data,height:t.tableHeight-215}},[a("Page",{attrs:{slot:"footer","class-name":"totalfr",total:t.tab2total,"page-size":t.tab2Params.limit,size:"small","show-total":""},on:{"on-change":t.tab2PageChange},slot:"footer"})],1)],1)],1)],1)],1)],1)},r=[],l=a("591a"),c=a("c276"),d={props:{modal:Boolean,queryDeviceId:[Number,String],actionUrl:String},data:function(){return{tabValue:0,selectTime:new Date(new Date((new Date).toLocaleDateString()).getTime()),tab1Params:{limit:30,pageNum:1,offset:0,showType:1},tab1total:0,tab1Data:[],tab2Params:{timeType:1,dataType:1,selectTime:0,limit:30,pageNum:1,offset:0},tab2total:0,tab2Data:[],tab1columns:[{title:"事件ID",key:"Id",minWidth:100},{title:"发生时间",key:"sendtime",minWidth:160,render:function(t,e){var a=Object(c["c"])(e.row.sendtime);return t("span",a)}},{title:"事件类型",key:"alert_type",minWidth:100,render:function(t,e){var a="";switch(e.row.alert_type){case"20":a="阀门打开";break;case"30":a="撞倒";break;case"60":a="水压异常";break;case"70":a="失联";break;default:break}return t("span",a)}},{title:"值",key:"cola",minWidth:60},{title:"公司名称",key:"company",minWidth:120},{title:"备注",key:"descrip",minWidth:50}],tab2Columns:[{title:"Timestamp",key:"sendtime",minWidth:160,render:function(t,e){var a=Object(c["c"])(e.row.sendtime);return t("span",a)}},{title:"事件类型",key:"alert_type",minWidth:100,render:function(t,e){var a="";switch(e.row.alert_type){case"20":a="阀门打开";break;case"30":a="撞倒";break;case"60":a="水压异常";break;case"70":a="失联";break;default:break}return t("span",a)}},{title:"serial_no",key:"cola",minWidth:60},{title:"状态",render:function(t,e){return t("span","已解析")}}]}},computed:{eventModal:{get:function(){return this.modal},set:function(){}},tableHeight:function(){return this.$store.state.user.windowH-60},token:function(){return this.$store.state.user.token}},watch:{queryDeviceId:{handler:function(t){this.tab1total=0,this.tab1Data=[],this.tab2total=0,this.tab2Data=[],this.tab1Params.showType=1,this.tab2Params.dataType=1,this.tab2Params.timeType=1,this.getDeviceEvent()},immediate:!0}},created:function(){var t=new Date(this.selectTime);this.tab2Params.selectTime=t.getTime()},methods:Object(n["a"])({},Object(l["b"])(["getDeviceAlertEvent","getDeviceAlertOriginData","exportDeviceEvent"]),{modalStateChange:function(t){this.$emit("modalState",t),t||(this.tabValue=0)},getDeviceEvent:function(){var t=this,e=JSON.parse(JSON.stringify(this.tab1Params));e.offset=(e.pageNum-1)*e.limit,e.device_id=this.queryDeviceId,this.getDeviceAlertEvent(e).then(function(e){null!=e.list?(t.tab1Data=e.list,t.tab1total=e.total):(t.tab1Data=[],t.tab1total=0)})},getDeviceOriginData:function(){var t=this,e=JSON.parse(JSON.stringify(this.tab2Params));e.offset=(e.pageNum-1)*e.limit,e.device_id=this.queryDeviceId,this.getDeviceAlertOriginData(e).then(function(e){null!=e.list?(t.tab2Data=e.list,t.tab2total=e.total):(t.tab2Data=[],t.tab2total=0)})},tabClick:function(t){1===t&&0==this.tab2Data.length&&this.getDeviceOriginData()},tab2TimeTypeChange:function(){this.getDeviceOriginData()},tab2DataTypeChange:function(){this.getDeviceOriginData()},tab2PageChange:function(t){this.tab2Params.pageNum=t,this.getDeviceOriginData()},tab2selectTimeChange:function(t){console.log(t);var e=new Date(t);console.log(e);var a=e.getTime()-288e5;this.tab2Params.selectTime=a,this.getDeviceOriginData()},showTypeChange:function(){this.getDeviceEvent()},tab1PageChange:function(t){this.tab1Params.pageNum=t,this.getDeviceEvent()}})},m=d,u=(a("ccb3"),a("17cc")),p=Object(u["a"])(m,o,r,!1,null,null,null),h=p.exports,g=a("b109"),b=a.n(g),v=a("543d"),f=a.n(v),y=a("2461"),T=a.n(y),D=a("446e"),P=a.n(D),w=a("92b4"),_=a.n(w),k=a("c3c6"),x=a.n(k),C={components:{eventModal:h},data:function(){return{loading:!0,ifeventModal:!1,eventModalShow:!1,queryDeviceId:0,signal0:b.a,signal1:f.a,signal2:T.a,signal3:P.a,signal4:_.a,signal5:x.a,columns:[{title:"项目名称",key:"company",minWidth:120},{title:"设备号",key:"device_id",minWidth:180},{title:"报警终端状态",slot:"state",minWidth:110},{title:"信号",slot:"signal",minWidth:60},{title:"地址",slot:"address",minWidth:250},{title:"主用户",key:"main_name",minWidth:100},{title:"手机号",key:"tel",minWidth:120},{title:"操作",slot:"action",minWidth:90}],deviceData:[],dataTotal:0,tabValue:0}},computed:Object(n["a"])({},Object(l["e"])({url:function(t){return t.user.baseUrl},tableHeight:function(t){return t.user.windowH-60},comId:function(t){return t.user.comId}}),Object(l["c"])(["deviceParams"])),watch:{deviceParams:{handler:function(){this.loading=!0,this.setDeviceList()},deep:!0}},created:function(){this.setDeviceList()},methods:Object(n["a"])({},Object(l["b"])(["deviceList"]),Object(l["d"])(["setCenterMarker","setDeviceParams"]),{eventQuery:function(t){this.ifeventModal=!0,this.eventModalShow=!0,this.queryDeviceId=t.device_id},changePage:function(t){this.deviceParams.pageNum=t,this.setDeviceParams(this.deviceParams)},setDeviceList:function(){var t=this,e=JSON.parse(JSON.stringify(this.deviceParams));e.offset=(Number(e.pageNum)-1)*Number(e.limit),1!==this.comId&&(e.companyId=this.comId),this.deviceList(this.deviceParams).then(function(e){if(t.deviceData=null===e.data.list?[]:e.data.list,t.dataTotal=e.data.count,t.dataTotal>0){var a=e.data.list[0];t.setCenterMarker({lng:a.lng,lat:a.lat})}t.loading=!1})},goMap:function(t){""!==t.lat?(this.$router.push({path:"map"}),this.setCenterMarker({lng:t.lng,lat:t.lat})):this.$Message.info("未安装")},eventModalState:function(t){this.eventModalShow=t}})},S=C,O=(a("c139"),Object(u["a"])(S,i,s,!1,null,null,null));e["default"]=O.exports},"19ae":function(t,e,a){},2461:function(t,e,a){t.exports=a.p+"img/signal2.af47f320.svg"},"446e":function(t,e,a){t.exports=a.p+"img/signal3.1fb2a381.svg"},"543d":function(t,e,a){t.exports=a.p+"img/signal1.452e23b8.svg"},"92b4":function(t,e,a){t.exports=a.p+"img/signal4.14343d49.svg"},b109:function(t,e,a){t.exports=a.p+"img/signal0.18a30dba.svg"},c139:function(t,e,a){"use strict";var i=a("19ae"),s=a.n(i);s.a},c3c6:function(t,e,a){t.exports=a.p+"img/signal5.86247446.svg"},c655:function(t,e,a){},ccb3:function(t,e,a){"use strict";var i=a("c655"),s=a.n(i);s.a}}]);