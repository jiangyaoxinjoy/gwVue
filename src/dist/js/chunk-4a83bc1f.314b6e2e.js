(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a83bc1f"],{"02c6":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Select",{style:{width:t.width+"px",height:"32px"},attrs:{disabled:1==t.companyList.length},on:{"on-change":t.changeCom},model:{value:t.companyId,callback:function(e){t.companyId=e},expression:"companyId"}},[1!=t.companyList.length?a("Option",{attrs:{value:0}},[t._v("全部")]):t._e(),t._l(t.companyList,function(e){return a("Option",{key:e.Id,attrs:{value:e.Id}},[t._v(t._s(e.name))])})],2)},i=[],r=(a("d4d5"),{name:"Companyselect",props:{companyList:Array,selectCompany:Number,width:{default:200,type:Number}},computed:{companyId:{get:function(){return this.selectCompany},set:function(){}}},methods:{changeCom:function(t){this.$emit("changeComId",t)}}}),s=r,o=a("17cc"),c=Object(o["a"])(s,n,i,!1,null,null,null),l=c.exports;a.d(e,"a",function(){return l})},1668:function(t,e,a){"use strict";var n=a("7013"),i=a.n(n);i.a},"5b4f":function(t,e,a){},7013:function(t,e,a){},"7a4f":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"demo-split"},[a("Split",{model:{value:t.split,callback:function(e){t.split=e},expression:"split"}},[a("div",{staticClass:"demo-split-pane",attrs:{slot:"left"},slot:"left"},[a("index-table")],1),a("div",{staticClass:"split-pane",attrs:{slot:"right"},slot:"right"},[a("Map")],1)])],1)},i=[],r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Table",{ref:"table",attrs:{columns:t.columns,data:t.alertList,loading:t.loading,"highlight-row":!0,height:t.tableHeight},on:{"on-row-click":t.setMarker},scopedSlots:t._u([{key:"state",fn:function(e){var n=e.row;e.index;return[a("span",[t._v(t._s(t._f("alarmTypeFilter")(n.state)))])]}}])},[a("div",{staticClass:"table_filter",attrs:{slot:"header"},slot:"header"},[a("RadioGroup",{staticClass:"group1",attrs:{type:"button"},on:{"on-change":t.alarmTypeChange},model:{value:t.params.alarmType,callback:function(e){t.$set(t.params,"alarmType",e)},expression:"params.alarmType"}},[a("Radio",{attrs:{label:"0"}},[t._v("全部")]),t._l(t.alarmTypeList,function(e){return a("Radio",{key:e.id,attrs:{label:e.key}},[t._v(t._s(e.title))])})],2),a("Companyselect",{attrs:{width:150,companyList:t.companyList,selectCompany:t.params.companyId},on:{changeComId:t.companyChange}})],1),a("Page",{attrs:{slot:"footer","class-name":"totalfr",total:t.totalCount,"page-size":t.params.limit,"show-total":"",current:1},on:{"on-change":t.changePage},slot:"footer"})],1)],1)},s=[],o=a("e20c"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",{staticClass:"expand-row"},[a("Col",{attrs:{span:"16"}},[a("span",{staticClass:"expand-key"},[t._v("地址: ")]),a("span",{staticClass:"expand-value"},[t._v(t._s(t.row.address))])])],1)],1)},l=[],u={props:{row:Object}},p=u,d=a("17cc"),m=Object(d["a"])(p,c,l,!1,null,null,null),h=m.exports,f=a("591a"),v=a("c276"),g=a("02c6"),y={name:"IndexTable",components:{expandRow:h,Companyselect:g["a"]},data:function(){return{params:{alarmType:"0",limit:100,offset:0,pageNum:1,companyId:0},alertList:[],totalCount:0,loading:!0,columns:[{type:"expand",width:40,render:function(t,e){return t(h,{props:{row:e.row}})}},{title:"序号",type:"index",align:"center",width:60},{title:"报警类型",key:"state",minWidth:90,slot:"state"},{title:"发生时间",key:"alarm_on",minWidth:150,render:function(t,e){var a=Object(v["c"])(e.row.hearttime);return t("span",a)}},{title:"设备号",key:"device_id",minWidth:180},{title:"公司名称",key:"company",minWidth:160},{title:"备注",key:"descrip",minWidth:200,ellipsis:!0}]}},computed:Object(o["a"])({},Object(f["e"])({alarmTypeList:function(t){return t.alert.alarmTypeList},tableHeight:function(t){return t.user.windowH-60},companyList:function(t){return t.user.companyList},comId:function(t){return t.user.comId},curMarker:function(t){return t.alert.curMarker},curDeviceId:function(t){return t.alert.curDeviceId}})),created:function(){this.initPage()},methods:Object(o["a"])({},Object(f["b"])(["getAlertList","getCompanyList"]),{initPage:function(){0===this.companyList.length&&this.getCompanyList(),1!==this.comId&&(this.params.companyId=this.comId),this.queryTableData()},queryTableData:function(){var t=this,e=JSON.parse(JSON.stringify(this.params));e.offset=(e.pageNum-1)*e.limit,this.getAlertList(e).then(function(e){t.alertList=null==e.list?[]:e.list,t.totalCount=e.count,e.count>0&&(t.alertList[0]["_highlight"]=!0,t.setMarker(t.alertList[0]))}),this.loading=!1},setMarker:function(t,e){var a=this.curMarker;a.lat===t.lat&&a.lng===t.lng||this.$store.commit("setCurMarker",{lat:t.lat,lng:t.lng,device_id:t.device_id})},changePage:function(t){this.params.pageNum=t,this.loading=!0,this.queryTableData()},alarmTypeChange:function(t){this.loading=!0,this.params.alarmType=t,this.params.pageNum=1,this.queryTableData()},companyChange:function(t){this.loading=!0,this.params.pageNum=1,this.params.companyId=t,this.queryTableData()}})},b=y,k=(a("1668"),Object(d["a"])(b,r,s,!1,null,"3be119dc",null)),w=k.exports,M=w,_=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"monitoringMap",style:{height:t.mapHeight+"px"},attrs:{id:"monitoringMap"}})])},C=[],I=(a("d4d5"),{name:"Map",data:function(){return{zoom:16}},computed:Object(o["a"])({},Object(f["e"])({mapHeight:function(t){return t.user.windowH-60},curMarker:function(t){return t.alert.curMarker},curDeviceId:function(t){return t.alert.curDeviceId}})),watch:{curMarker:{handler:function(t){var e=this;"{}"!=JSON.stringify(t)&&setTimeout(function(){e.setMarker()},500)},immediate:!0}},mounted:function(){console.log(11111);var t=new BMap.Map("monitoringMap");this.map=t,t.setCurrentCity("上海"),t.enableScrollWheelZoom(!0)},methods:Object(o["a"])({},Object(f["b"])(["getDeviceAlertInfo"]),{setMarker:function(){var t=this.map;this.removeMarkerEvent();var e=new BMap.Point(this.curMarker.lng,this.curMarker.lat),a=new BMap.Point(this.curMarker.lng,Number(this.curMarker.lat)+.007),n=new BMap.Marker(e);t.addOverlay(n),t.centerAndZoom(a,this.zoom);n.addEventListener("click",this.markerWindow),this.markerWindow()},markerWindow:function(){var t=this,e=this.map,a={width:450,height:500},n='\n        <div id="windowInfo">\n          <div class="ivu-spin ivu-spin-large ivu-spin-fix">\n            <div class="ivu-spin-main">\n              <span class="ivu-spin-dot"></span> \n              <div class="ivu-spin-text"></div>\n            </div>\n          </div>\n        </div>',i=new BMap.Point(this.curMarker.lng,this.curMarker.lat),r=new BMap.InfoWindow(n,a);this.infoWindow=r,e.openInfoWindow(r,i),this.getDeviceAlertInfo({device_id:this.curDeviceId}).then(function(e){setTimeout(function(){t.$windowinfo(e,!0)})})},removeMarkerEvent:function(){for(var t=this.map,e=t.getOverlays(),a=0;a<e.length;a++)console.log("removeMarkerEvent"),e[a].removeEventListener("click",this.markerWindow),t.removeOverlay(e[a])}})}),x=I,L=(a("90ca"),Object(d["a"])(x,_,C,!1,null,null,null)),O=L.exports,T={name:"home",components:{Map:O,IndexTable:M},data:function(){return{split:.4}},computed:{curMarker:function(){return this.$store.state.alert.curMarker}}},j=T,W=(a("d75a"),Object(d["a"])(j,n,i,!1,null,null,null));e["default"]=W.exports},"90ca":function(t,e,a){"use strict";var n=a("5b4f"),i=a.n(n);i.a},d75a:function(t,e,a){"use strict";var n=a("f87f"),i=a.n(n);i.a},f87f:function(t,e,a){}}]);